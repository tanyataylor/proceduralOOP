<?php
error_reporting(E_ALL|E_STRICT);
ini_set('display_errors',1);

class Logs{

    public function __construct(){

        $this->initialize();

    }

    public function initialize(){
        $this->displayMonths();


        if(isset($_GET['month'])){
            $this->listLogFiles($_GET['month']);}



    }
    public function displayMonths(){
        if(substr($_SERVER['REQUEST_URI'],-1) == 'Logs.php'){
        $url = $_SERVER['PHP_SELF'];
            echo "<h4>Log File List</h4>";

            echo "<form name='display_logs' method='get' action='{$url}'>
        Select Month:<br />
        <select name='month'>
            <option value='null'>--</option>
            <option value='01'>January</option>
            <option value='02'>February</option>
            <option value='03'>March</option>
            <option value='04'>April</option>
            <option value='05'>May</option>
            <option value='06'>June</option>
            <option value='07'>July</option>
            <option value='08'>August</option>
            <option value='09'>September</option>
            <option value='10'>October</option>
            <option value='11'>November</option>
            <option value='12'>December</option>
        </select><br />
        <input type='submit' value='View Log' size='12' name='submit'><br />
    </form>";
    }}

    public function listLogFiles($month = 'null'){

        $str = "logs/*";
        if ($_GET['month'] != 'null'){
            $str .= "-{$month}-*.log";

        }
        else {
            $str .= ".log";
        }

        foreach((array) glob($str) as $file){

            echo "<a href='logs.php?filename=".substr($file,5)."&month=".$month."'>$file</a><br/>";
            if ((isset($_GET['filename'])) && $_GET['filename']== substr($file,5))
            {
                echo displayFileContents($_GET['filename']);
            }
        }
    }

    public function displayFileContents($fileName){
//$path = getcwd();    //add /logs/
//echo $path;
        $path = '/var/www/proceduralRefactored/logs/';
        $fileToRead = $path.$fileName;
        $fh = fopen($fileToRead,'r');
        $data = fread($fh, filesize($fileToRead));
        fclose($fh);
        return $data;
    }

}
$log = new Logs();




